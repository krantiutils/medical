# Ralph Progress Log
Started: Mon Feb  2 01:28:58 AM +0545 2026

## Codebase Patterns
- Next.js 14 App Router: dynamic route params are `Promise<{}>` - always `await params` before using
- Use symlink for .env in packages/database (`ln -sf ../../.env packages/database/.env`) to allow Prisma to access root .env
- Turborepo tasks that need DATABASE_URL must have the symlink in place
- @types/node is required in packages/database for process.env type support
- Run `pnpm db:generate` before typecheck to ensure Prisma client is generated
- Bauhaus design tokens: primary-red (#D02020), primary-blue (#1040C0), primary-yellow (#F0C020), background (#F0F0F0), foreground (#121212)
- Hard shadows use `shadow-[Xpx_Xpx_0_0_#121212]` format (never blurred)
- Use next/font/google for fonts, set CSS variable via className on <html>
- For Prisma migrations in non-interactive env: use `prisma migrate diff --from-empty --to-schema-datamodel` to generate SQL, then `prisma migrate resolve --applied` after db push
- Use `docker-compose` (v1 syntax) not `docker compose` on this system
- Don't set `rootDir` in packages/database/tsconfig.json - scripts are outside src/ and need to be typechecked too
- Import scripts in packages/database/scripts/ use `tsx` to run TypeScript directly
---

## 2026-02-02 01:52 +0545 - US-001
- **What was implemented**: Verified and completed project setup
- **Files changed**:
  - `turbo.json` - Added globalEnv for DATABASE_URL
  - `packages/database/.env` - Created symlink to root .env
  - `packages/database/package.json` - Added @types/node devDependency
  - `prd.json` - Marked US-001 as passes: true
- **Learnings for future iterations:**
  - Prisma needs .env file accessible - symlink is cleaner than dotenv-cli
  - Turbo 2.x uses `globalEnv` not `globalDotEnv` for env var declaration
  - The scaffolding was mostly pre-existing, this iteration verified it works
  - Docker needs sudo on this machine (password in CLAUDE.md)
---

## 2026-02-02 02:15 +0545 - US-002
- **What was implemented**: Design system setup with Bauhaus tokens and base components
- **Files changed**:
  - `apps/web/package.json` - Added tailwindcss, postcss, autoprefixer
  - `apps/web/tailwind.config.ts` - Created with Bauhaus color tokens, hard shadows, custom font sizes
  - `apps/web/postcss.config.js` - Created PostCSS configuration
  - `apps/web/src/app/globals.css` - Created with CSS variables, hard shadow utilities
  - `apps/web/src/app/layout.tsx` - Updated with Outfit font via next/font/google, imports globals.css
  - `prd.json` - Marked US-002 as passes: true
- **Learnings for future iterations:**
  - Use `next/font/google` for font loading (removes @import from CSS, better performance)
  - Bauhaus colors are: primary-red (#D02020), primary-blue (#1040C0), primary-yellow (#F0C020)
  - Background is off-white #F0F0F0, foreground is stark black #121212
  - Hard shadows use format: `shadow-[Xpx_Xpx_0_0_#121212]` (no blur, just offset)
  - Custom utility classes like `shadow-hard-xl` defined in globals.css @layer utilities
  - Font CSS variable `--font-outfit` set on <html> via className={outfit.variable}
---

## 2026-02-02 03:00 +0545 - US-003
- **What was implemented**: Database schema for Professional model
- **Files changed**:
  - `packages/database/prisma/migrations/20260202000000_create_professional_model/migration.sql` - Created migration with Professional table, enum, and indexes
  - `prd.json` - Marked US-003 as passes: true
- **Learnings for future iterations:**
  - Schema was pre-existing, this iteration added the migration file and verified sync
  - `prisma migrate dev` requires interactive terminal; use `prisma db push` for dev sync or create migration manually
  - Use `prisma migrate resolve --applied <name>` to mark migration as applied when schema already synced
  - Use `docker-compose` (v1) not `docker compose` (v2) on this system
  - Professional model fields: id, type (enum), registration_number (unique), full_name, full_name_ne, photo_url, gender, address, degree, specialties[], registration_date, remarks, verified, slug (indexed), created_at, updated_at, last_synced_at, meta (Json)
---

## 2026-02-02 04:15 +0545 - US-004
- **What was implemented**: User and VerificationRequest models for authentication and profile claiming
- **Files changed**:
  - `packages/database/prisma/schema.prisma` - Added User model, VerificationRequest model, UserRole enum, VerificationStatus enum, and relations
  - `packages/database/prisma/migrations/20260202010000_add_user_and_verification_models/migration.sql` - Created migration SQL
  - `prd.json` - Marked US-004 as passes: true
- **Learnings for future iterations:**
  - User model has relations to VerificationRequest (two: as requester and as reviewer) and Professional (claimed_by)
  - Use named relations (`@relation("UserRequests")`, `@relation("ReviewedBy")`, `@relation("ClaimedBy")`) when a model has multiple relations to the same target
  - VerificationRequest has FK to both User (user_id for requester, reviewed_by_id for admin reviewer) and Professional (professional_id)
  - Professional now has optional claimed_by_id to track who has claimed/verified ownership
  - Use `prisma db push` followed by manual migration file creation and `prisma migrate resolve --applied <name>` in non-interactive environments
---

## 2026-02-02 05:00 +0545 - US-005
- **What was implemented**: Data import script for doctors CSV
- **Files changed**:
  - `packages/database/scripts/import-doctors.ts` - Created import script with CSV parsing, slug generation, upsert logic
  - `packages/database/package.json` - Added csv-parse dependency
  - `packages/database/tsconfig.json` - Removed rootDir to allow scripts/ to be typechecked
  - `pnpm-lock.yaml` - Updated with csv-parse
  - `prd.json` - Marked US-005 as passes: true
- **Learnings for future iterations:**
  - CSV has columns: nmc_no, full_name, address, gender, degree, remarks, scraped_at (extra scraped_at not in PRD)
  - Slug format: `dr-{slugified-name}-{nmc_no}` (removes "Dr." prefix, lowercases, replaces non-alphanumeric with hyphens)
  - Use csv-parse with `columns: true` to get objects keyed by header names
  - Use batch processing (Promise.all on batches of 100) for 38k+ records
  - Upsert determines created vs updated by comparing created_at and updated_at timestamps (within 1 second = created)
  - Don't set rootDir in tsconfig if you have scripts/ outside src/ that need typechecking
---

## 2026-02-02 06:30 +0545 - US-006
- **What was implemented**: Data import script for dentists CSV
- **Files changed**:
  - `packages/database/scripts/import-dentists.ts` - Created import script following doctors pattern
  - `prd.json` - Marked US-006 as passes: true
- **Learnings for future iterations:**
  - Dentists CSV has columns: nmc_no, nda_id, name, location, scraped_at (note: `name` not `full_name`)
  - nda_id is mostly empty in the dataset but stored in `meta` field when present
  - location field maps to address (also mostly empty)
  - Same slug pattern as doctors: `dr-{slugified-name}-{nmc_no}`
  - npm script `pnpm import:dentists` was already defined in package.json
---

## 2026-02-02 07:15 +0545 - US-007
- **What was implemented**: Data import script for pharmacists CSV
- **Files changed**:
  - `packages/database/scripts/import-pharmacists.ts` - Created import script following dentists pattern
  - `prd.json` - Marked US-007 as passes: true
- **Learnings for future iterations:**
  - Pharmacists CSV has columns: reg_no, name, reg_date, category, scraped_at
  - Different slug pattern for pharmacists: `pharmacist-{slugified-name}-{regNo}` (no "dr-" prefix since they're not doctors)
  - category field (e.g., "Graduate Pharmacist") stored in `meta.category`
  - reg_date is in YYYY-MM-DD format, parsed and stored in `registration_date` field
  - npm script `pnpm import:pharmacists` was already defined in package.json
---

## 2026-02-02 08:00 +0545 - US-008
- **What was implemented**: Button component with Bauhaus design system styling
- **Files changed**:
  - `apps/web/src/components/ui/button.tsx` - Created Button component with variants, sizes, and Bauhaus styling
  - `prd.json` - Marked US-008 as passes: true
- **Learnings for future iterations:**
  - Component structure: `apps/web/src/components/ui/` for UI primitives
  - Button uses forwardRef for proper ref forwarding to underlying button element
  - Variants are defined as Record types for type-safe variant maps
  - Tailwind arbitrary values like `shadow-[4px_4px_0_0_#121212]` work inline for hard shadows
  - Active state uses `active:translate-x-[2px] active:translate-y-[2px] active:shadow-none` for pressed effect
  - Ghost variant has transparent border that appears on hover for subtle interaction
  - Export types alongside component for consumers to type props properly
---

## 2026-02-02 09:00 +0545 - US-009
- **What was implemented**: Card component with Bauhaus design system styling
- **Files changed**:
  - `apps/web/src/components/ui/card.tsx` - Created Card component with subcomponents (CardHeader, CardContent, CardFooter)
  - `prd.json` - Marked US-009 as passes: true
- **Learnings for future iterations:**
  - Card uses shadow-xl from tailwind config which is `8px 8px 0 0 #121212` - matches Bauhaus hard shadow pattern
  - Geometric decorator is optional via `decorator` prop (red/blue/yellow/none) and `decoratorPosition` prop
  - Decorator is a 4x4 (w-4 h-4) square with aria-hidden="true" for accessibility
  - CardFooter has border-t-2 border-foreground/20 for subtle section separation
  - Use forwardRef pattern consistently for all UI primitives to allow proper ref forwarding
  - Component structure follows Button pattern: Record types for variant maps, export types alongside component
---

## 2026-02-02 10:30 +0545 - US-010
- **What was implemented**: Professional detail page with basic route and layout
- **Files changed**:
  - `apps/web/src/app/[lang]/doctor/[slug]/page.tsx` - Created dynamic route page with database fetch, Card layout
  - `apps/web/src/app/[lang]/layout.tsx` - Created language layout with en/ne validation
  - `apps/web/src/app/[lang]/not-found.tsx` - Created 404 page with Bauhaus styling
  - `prd.json` - Marked US-010 as passes: true
- **Learnings for future iterations:**
  - Next.js 14 App Router uses `params: Promise<{}>` for dynamic route params - must await them
  - Use `notFound()` from `next/navigation` to trigger 404 - cleaner than throwing errors
  - Import Prisma client from `@swasthya/database` (workspace package) - already configured as singleton
  - Professional type field determines display name prefix: "Dr." for DOCTOR/DENTIST, none for PHARMACIST
  - Card decorator colors (red/blue/yellow) can be used to differentiate sections visually
  - Mobile responsive: use `flex-col sm:flex-row` for photo+info layouts
  - The `[lang]` structure is set up now - will be extended with next-intl in US-021
  - Slug-based lookup uses `findFirst` with `where: { slug }` - ensure slugs are unique in practice
---

## 2026-02-02 11:00 +0545 - US-011
- **What was implemented**: SEO meta tags for professional detail page
- **Files changed**:
  - `apps/web/src/app/[lang]/doctor/[slug]/page.tsx` - Added generateMetadata function with full SEO support
  - `prd.json` - Marked US-011 as passes: true
- **Learnings for future iterations:**
  - `generateMetadata` is an async function that receives the same props as the page component
  - Use `type: "profile"` for OpenGraph on person/professional pages (not "website")
  - Twitter card `summary` is suitable for profile-like content; `summary_large_image` is for article-like content
  - `alternates.languages` provides hreflang-like functionality for multi-language sites
  - SITE_URL should be configured via `NEXT_PUBLIC_SITE_URL` env var for production
  - Fallback to og-default.png for professionals without photo_url - this image needs to be created later
  - Meta description should include credentials, location, and registration number for SEO authority
---

## 2026-02-02 12:00 +0545 - US-012
- **What was implemented**: JSON-LD structured data for professional detail page
- **Files changed**:
  - `apps/web/src/app/[lang]/doctor/[slug]/page.tsx` - Added generateJsonLd function and JSON-LD script tag
  - `prd.json` - Marked US-012 as passes: true
- **Learnings for future iterations:**
  - Use schema.org Physician type for doctors, Dentist type for dentists
  - For pharmacists, use Person with hasOccupation since there's no Pharmacist type in schema.org
  - JSON-LD identifier uses PropertyValue with propertyID (e.g., "NMC Number") and value
  - Address uses PostalAddress with addressLocality and addressCountry
  - Use `dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}` for script tags in React
  - medicalSpecialty falls back to degree if specialties array is empty
  - Include @id and url for proper entity identification in rich results
---

## 2026-02-02 13:00 +0545 - US-013
- **What was implemented**: Professional detail page styled with design system
- **Files changed**:
  - `apps/web/src/app/[lang]/doctor/[slug]/page.tsx` - Applied Bauhaus design system styling per spec
  - `apps/web/.eslintrc.json` - Added ESLint config for Next.js linting
  - `prd.json` - Marked US-013 as passes: true
- **Learnings for future iterations:**
  - Specialty label should be text-xs font-bold uppercase tracking-widest text-primary-blue
  - Use border-t-2 border-black/20 for section dividers, divide-y-2 divide-black/10 for item separation
  - Verified badge: green bg with white text, Check icon inside white circle
  - Icons should use accent colors and be contained in rounded-full circles (e.g., w-8 h-8 bg-primary-blue rounded-full)
  - Use gap-3 for icon + text alignment in detail items
  - Added .eslintrc.json to prevent interactive ESLint prompts during lint
  - Next.js warns about <img> vs <Image> component - consider optimizing later (out of scope for styling)
---

## 2026-02-02 14:30 +0545 - US-014
- **What was implemented**: Homepage hero section with Bauhaus design
- **Files changed**:
  - `apps/web/src/app/[lang]/page.tsx` - Created homepage with hero section and categories
  - `prd.json` - Marked US-014 as passes: true
- **Learnings for future iterations:**
  - Use `"use client"` directive for pages with useState/form handling
  - Hero text: text-6xl lg:text-8xl font-black uppercase with leading-[0.9] for tight line height
  - Color blocking: Use lg:flex-row with hidden lg:flex for desktop-only color panel
  - Geometric shapes: Use absolute positioning within relative container, clip-path polygon for triangles
  - Search form: flex-col sm:flex-row gap-4 for responsive stacking
  - Quick stats: Small colored squares (w-3 h-3) with Bauhaus colors for visual differentiation
  - Mobile fallback: Use h-4 flex bar with colored segments instead of geometric panel
  - Category cards: Use anchor tags with group class, hover:shadow-[color] for colored shadow on hover
  - Escape apostrophes with &apos; in JSX to satisfy ESLint react/no-unescaped-entities
---

## 2026-02-02 15:00 +0545 - US-015
- **What was implemented**: Search results page with basic listing and pagination
- **Files changed**:
  - `apps/web/src/app/[lang]/search/page.tsx` - Created search page with query param handling, ILIKE search, responsive grid, pagination
  - `prd.json` - Marked US-015 as passes: true
- **Learnings for future iterations:**
  - Use `searchParams: Promise<{}>` for query params in Next.js 14 App Router (must await like params)
  - Prisma `contains` with `mode: "insensitive"` provides ILIKE behavior for case-insensitive search
  - Responsive grid: `grid-cols-1 md:grid-cols-2 lg:grid-cols-4` for 1/2/4 column layout
  - Use `line-clamp-1` and `line-clamp-2` for text truncation in cards
  - Card decorator colors: blue for DOCTOR, red for DENTIST, yellow for PHARMACIST
  - For pagination, use `skip` and `take` with Prisma, and `Math.ceil(totalCount / ITEMS_PER_PAGE)` for total pages
  - Generate page numbers with ellipsis for better UX on large page counts
  - Use native `<form action="url" method="GET">` for server-side search (no "use client" needed)
  - All professionals currently use /doctor/[slug] route - this may change with dentist/pharmacist-specific routes
---

## 2026-02-02 16:00 +0545 - US-016
- **What was implemented**: Search results page filters for type and location
- **Files changed**:
  - `apps/web/src/app/[lang]/search/page.tsx` - Added type and location filter dropdowns, active filter tags, updated pagination to preserve filters
  - `prd.json` - Marked US-016 as passes: true
- **Learnings for future iterations:**
  - Import `ProfessionalType` enum from `@swasthya/database` for type validation
  - Use `Object.values(EnumType).includes(value)` to validate enum values from URL params
  - Build URL with `URLSearchParams` for clean query string construction
  - Combine Prisma conditions with `{ AND: conditions }` when multiple filters apply
  - Use `distinct: ["field"]` in Prisma to get unique values for dropdown options
  - Form `onChange` with `form.submit()` provides instant filter application without button
  - Active filters as tags with X icon use Link components for easy removal (omit the param)
  - Filter tags use Bauhaus colors: blue for type, yellow for location
  - Hidden inputs preserve filter state when submitting search query form
  - Don't use `@typescript-eslint/no-explicit-any` disable comment - ESLint rule not configured in this project
---

## 2026-02-02 17:00 +0545 - US-017
- **What was implemented**: Navigation header component with Bauhaus design
- **Files changed**:
  - `apps/web/src/components/layout/header.tsx` - Created header component with logo, nav, language switcher, login button, mobile menu
  - `apps/web/src/app/[lang]/layout.tsx` - Integrated Header component into the [lang] layout
  - `prd.json` - Marked US-017 as passes: true
- **Learnings for future iterations:**
  - Layout components go in `apps/web/src/components/layout/` directory
  - Use `"use client"` directive for components with useState (like mobile menu toggle)
  - Use `usePathname()` from next/navigation to get current path for active link highlighting
  - Language switcher needs to preserve current path when switching - strip lang prefix then add new one
  - Login button uses inline styles matching Button outline variant since Button doesn't support asChild prop
  - Mobile menu uses conditional rendering with hamburger/X toggle icon
  - Header uses `sticky top-0 z-50` for sticky positioning without covering content
  - Nav links array pattern makes adding/removing links easy without code duplication
  - Active link check: exact match for home (`/lang`), startsWith for other pages
---

## 2026-02-02 18:00 +0545 - US-018
- **What was implemented**: Footer component with Bauhaus design
- **Files changed**:
  - `apps/web/src/components/layout/footer.tsx` - Created footer component with logo, sections, social links
  - `apps/web/src/app/[lang]/layout.tsx` - Integrated Footer, added flex layout for sticky footer
  - `prd.json` - Marked US-018 as passes: true
- **Learnings for future iterations:**
  - Footer uses same component structure as Header (lang prop, getLinkHref helper)
  - Layout uses `min-h-screen flex flex-col` with `flex-1` on main for sticky footer pattern
  - Social links use external links with `target="_blank" rel="noopener noreferrer"`
  - Section titles use `text-xs font-bold uppercase tracking-widest text-primary-yellow` for consistency
  - Footer links use `text-white/70 hover:text-white` for subtle hover effect
  - Use `&apos;` for apostrophes in JSX to satisfy ESLint
  - Decorative Bauhaus elements (circle/square/triangle) repeated in footer for brand consistency
---

## 2026-02-02 19:00 +0545 - US-019
- **What was implemented**: Sitemap generation for SEO
- **Files changed**:
  - `apps/web/src/app/sitemap.ts` - Created sitemap with Next.js convention and sitemap index support
  - `prd.json` - Marked US-019 as passes: true
- **Learnings for future iterations:**
  - Next.js sitemap uses `generateSitemaps` function for sitemap index pattern (when >50k URLs)
  - The sitemap function receives `{ id }` param when `generateSitemaps` is exported
  - Use `skip` and `take` with Prisma for pagination across sitemap chunks
  - Include both language variants (/en/ and /ne/) for each URL
  - Static pages only go in first sitemap (id === 0) to avoid duplication
  - Verified professionals get higher priority (0.8) than unverified (0.7)
  - Use `updated_at` from database as `lastModified` for accurate sitemap timestamps
  - Select only needed fields (slug, updated_at, verified) for performance with 40k+ records
---

## 2026-02-02 20:00 +0545 - US-020
- **What was implemented**: robots.txt and SEO basics configuration
- **Files changed**:
  - `apps/web/src/app/robots.ts` - Created robots.txt using Next.js MetadataRoute.Robots convention
  - `apps/web/src/app/layout.tsx` - Added comprehensive default metadata for SEO
  - `prd.json` - Marked US-020 as passes: true
- **Learnings for future iterations:**
  - Use `MetadataRoute.Robots` type from "next" for type-safe robots.ts configuration
  - `metadataBase` in metadata object is essential for resolving relative URLs in OpenGraph/Twitter images
  - Title template `%s | Swasthya` allows child pages to just set the page-specific part
  - `formatDetection` can disable auto-linking of emails/phones/addresses by mobile browsers
  - Use `GOOGLE_SITE_VERIFICATION` env var for Google Search Console verification (no public prefix needed)
  - robots directive in metadata provides additional control beyond robots.txt
  - googleBot specific directives like `max-video-preview`, `max-image-preview`, `max-snippet` optimize rich snippets
---

## 2026-02-02 21:00 +0545 - US-021
- **What was implemented**: i18n setup with next-intl configuration
- **Files changed**:
  - `apps/web/messages/en.json` - Created English translation file with common, home, nav, footer, search, doctor, notFound, and metadata translations
  - `apps/web/messages/ne.json` - Created Nepali translation file with same structure as English
  - `apps/web/src/i18n/config.ts` - Created i18n configuration with locales array, defaultLocale, and localeNames
  - `apps/web/src/i18n/request.ts` - Created next-intl request configuration using getRequestConfig
  - `apps/web/src/middleware.ts` - Created middleware for locale detection with localePrefix: 'always'
  - `apps/web/next.config.mjs` - Updated to use createNextIntlPlugin wrapper
  - `apps/web/src/app/[lang]/layout.tsx` - Updated to use NextIntlClientProvider, setRequestLocale, getMessages
  - `apps/web/package.json` - Added next-intl dependency
  - `prd.json` - Marked US-021 as passes: true
- **Learnings for future iterations:**
  - next-intl uses `getRequestConfig` from `next-intl/server` for async message loading
  - Use `setRequestLocale(locale)` at the start of layouts/pages to enable static rendering
  - `NextIntlClientProvider` wraps client components to provide translations via `useTranslations` hook
  - Middleware uses `localePrefix: 'always'` to enforce /en/ and /ne/ in all URLs
  - Messages are organized by namespace (common, home, nav, footer, search, etc.) for clean organization
  - `generateStaticParams` should export all supported locales for static generation
  - The i18n config exports types (`Locale`) for type-safe locale handling
  - next-intl plugin wraps Next.js config: `withNextIntl(nextConfig)`
---

## 2026-02-02 22:00 +0545 - US-022
- **What was implemented**: Category page for doctors listing at /[lang]/doctors
- **Files changed**:
  - `apps/web/src/app/[lang]/doctors/page.tsx` - Created doctors category page with listing, pagination, and SEO
  - `prd.json` - Marked US-022 as passes: true
- **Learnings for future iterations:**
  - Category pages follow the search page pattern but filter by professional type
  - Use `ProfessionalType.DOCTOR` enum value for type filtering (not string "DOCTOR")
  - Decorator color should match the professional type: blue for doctors, red for dentists, yellow for pharmacists
  - Inline translations (t object) work for simple cases, could be moved to messages JSON for full i18n
  - Use `toLocaleString("ne-NP")` for Nepali number formatting
  - `generateStaticParams` exports locales for static generation of category pages
  - `setRequestLocale(lang)` is needed at start of page component for proper static rendering
---
