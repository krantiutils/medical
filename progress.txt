# Ralph Progress Log
Started: Mon Feb  2 01:28:58 AM +0545 2026

## Codebase Patterns
- Use symlink for .env in packages/database (`ln -sf ../../.env packages/database/.env`) to allow Prisma to access root .env
- Turborepo tasks that need DATABASE_URL must have the symlink in place
- @types/node is required in packages/database for process.env type support
- Run `pnpm db:generate` before typecheck to ensure Prisma client is generated
- Bauhaus design tokens: primary-red (#D02020), primary-blue (#1040C0), primary-yellow (#F0C020), background (#F0F0F0), foreground (#121212)
- Hard shadows use `shadow-[Xpx_Xpx_0_0_#121212]` format (never blurred)
- Use next/font/google for fonts, set CSS variable via className on <html>
- For Prisma migrations in non-interactive env: use `prisma migrate diff --from-empty --to-schema-datamodel` to generate SQL, then `prisma migrate resolve --applied` after db push
- Use `docker-compose` (v1 syntax) not `docker compose` on this system
- Don't set `rootDir` in packages/database/tsconfig.json - scripts are outside src/ and need to be typechecked too
- Import scripts in packages/database/scripts/ use `tsx` to run TypeScript directly
---

## 2026-02-02 01:52 +0545 - US-001
- **What was implemented**: Verified and completed project setup
- **Files changed**:
  - `turbo.json` - Added globalEnv for DATABASE_URL
  - `packages/database/.env` - Created symlink to root .env
  - `packages/database/package.json` - Added @types/node devDependency
  - `prd.json` - Marked US-001 as passes: true
- **Learnings for future iterations:**
  - Prisma needs .env file accessible - symlink is cleaner than dotenv-cli
  - Turbo 2.x uses `globalEnv` not `globalDotEnv` for env var declaration
  - The scaffolding was mostly pre-existing, this iteration verified it works
  - Docker needs sudo on this machine (password in CLAUDE.md)
---

## 2026-02-02 02:15 +0545 - US-002
- **What was implemented**: Design system setup with Bauhaus tokens and base components
- **Files changed**:
  - `apps/web/package.json` - Added tailwindcss, postcss, autoprefixer
  - `apps/web/tailwind.config.ts` - Created with Bauhaus color tokens, hard shadows, custom font sizes
  - `apps/web/postcss.config.js` - Created PostCSS configuration
  - `apps/web/src/app/globals.css` - Created with CSS variables, hard shadow utilities
  - `apps/web/src/app/layout.tsx` - Updated with Outfit font via next/font/google, imports globals.css
  - `prd.json` - Marked US-002 as passes: true
- **Learnings for future iterations:**
  - Use `next/font/google` for font loading (removes @import from CSS, better performance)
  - Bauhaus colors are: primary-red (#D02020), primary-blue (#1040C0), primary-yellow (#F0C020)
  - Background is off-white #F0F0F0, foreground is stark black #121212
  - Hard shadows use format: `shadow-[Xpx_Xpx_0_0_#121212]` (no blur, just offset)
  - Custom utility classes like `shadow-hard-xl` defined in globals.css @layer utilities
  - Font CSS variable `--font-outfit` set on <html> via className={outfit.variable}
---

## 2026-02-02 03:00 +0545 - US-003
- **What was implemented**: Database schema for Professional model
- **Files changed**:
  - `packages/database/prisma/migrations/20260202000000_create_professional_model/migration.sql` - Created migration with Professional table, enum, and indexes
  - `prd.json` - Marked US-003 as passes: true
- **Learnings for future iterations:**
  - Schema was pre-existing, this iteration added the migration file and verified sync
  - `prisma migrate dev` requires interactive terminal; use `prisma db push` for dev sync or create migration manually
  - Use `prisma migrate resolve --applied <name>` to mark migration as applied when schema already synced
  - Use `docker-compose` (v1) not `docker compose` (v2) on this system
  - Professional model fields: id, type (enum), registration_number (unique), full_name, full_name_ne, photo_url, gender, address, degree, specialties[], registration_date, remarks, verified, slug (indexed), created_at, updated_at, last_synced_at, meta (Json)
---

## 2026-02-02 04:15 +0545 - US-004
- **What was implemented**: User and VerificationRequest models for authentication and profile claiming
- **Files changed**:
  - `packages/database/prisma/schema.prisma` - Added User model, VerificationRequest model, UserRole enum, VerificationStatus enum, and relations
  - `packages/database/prisma/migrations/20260202010000_add_user_and_verification_models/migration.sql` - Created migration SQL
  - `prd.json` - Marked US-004 as passes: true
- **Learnings for future iterations:**
  - User model has relations to VerificationRequest (two: as requester and as reviewer) and Professional (claimed_by)
  - Use named relations (`@relation("UserRequests")`, `@relation("ReviewedBy")`, `@relation("ClaimedBy")`) when a model has multiple relations to the same target
  - VerificationRequest has FK to both User (user_id for requester, reviewed_by_id for admin reviewer) and Professional (professional_id)
  - Professional now has optional claimed_by_id to track who has claimed/verified ownership
  - Use `prisma db push` followed by manual migration file creation and `prisma migrate resolve --applied <name>` in non-interactive environments
---

## 2026-02-02 05:00 +0545 - US-005
- **What was implemented**: Data import script for doctors CSV
- **Files changed**:
  - `packages/database/scripts/import-doctors.ts` - Created import script with CSV parsing, slug generation, upsert logic
  - `packages/database/package.json` - Added csv-parse dependency
  - `packages/database/tsconfig.json` - Removed rootDir to allow scripts/ to be typechecked
  - `pnpm-lock.yaml` - Updated with csv-parse
  - `prd.json` - Marked US-005 as passes: true
- **Learnings for future iterations:**
  - CSV has columns: nmc_no, full_name, address, gender, degree, remarks, scraped_at (extra scraped_at not in PRD)
  - Slug format: `dr-{slugified-name}-{nmc_no}` (removes "Dr." prefix, lowercases, replaces non-alphanumeric with hyphens)
  - Use csv-parse with `columns: true` to get objects keyed by header names
  - Use batch processing (Promise.all on batches of 100) for 38k+ records
  - Upsert determines created vs updated by comparing created_at and updated_at timestamps (within 1 second = created)
  - Don't set rootDir in tsconfig if you have scripts/ outside src/ that need typechecking
---

## 2026-02-02 06:30 +0545 - US-006
- **What was implemented**: Data import script for dentists CSV
- **Files changed**:
  - `packages/database/scripts/import-dentists.ts` - Created import script following doctors pattern
  - `prd.json` - Marked US-006 as passes: true
- **Learnings for future iterations:**
  - Dentists CSV has columns: nmc_no, nda_id, name, location, scraped_at (note: `name` not `full_name`)
  - nda_id is mostly empty in the dataset but stored in `meta` field when present
  - location field maps to address (also mostly empty)
  - Same slug pattern as doctors: `dr-{slugified-name}-{nmc_no}`
  - npm script `pnpm import:dentists` was already defined in package.json
---
